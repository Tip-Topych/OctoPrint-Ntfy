<form class="form-horizontal">
    <fieldset>
        <legend>Настройки Ntfy</legend>

        <div class="control-group">
            <label class="control-label">Ntfy Server URL</label>
            <div class="controls">
                <input type="text" class="input-block-level" data-bind="value: settings.plugins.ntfy.server_url">
                <span class="help-block">Например: https://ntfy.sh или ваш self-hosted адрес</span>
            </div>
        </div>

        <div class="control-group">
            <label class="control-label">Topic (Топик)</label>
            <div class="controls">
                <input type="text" class="input-block-level" data-bind="value: settings.plugins.ntfy.topic">
            </div>
        </div>

        <div class="control-group">
            <label class="control-label">Access Token (Опционально)</label>
            <div class="controls">
                <input type="password" class="input-block-level" data-bind="value: settings.plugins.ntfy.access_token">
                <span class="help-block">Требуется, если ваш топик защищен.</span>
            </div>
        </div>

        <div class="control-group">
            <div class="controls">
                <label class="checkbox">
                    <input type="checkbox" data-bind="checked: settings.plugins.ntfy.include_snapshot"> Прикреплять снимок с камеры
                </label>
            </div>
        </div>

        <legend>События</legend>
        <div class="control-group">
            <div class="controls">
                <label class="checkbox">
                    <input type="checkbox" data-bind="checked: settings.plugins.ntfy.event_print_started"> Печать началась
                </label>
                <label class="checkbox">
                    <input type="checkbox" data-bind="checked: settings.plugins.ntfy.event_print_done"> Печать завершена
                </label>
                <label class="checkbox">
                    <input type="checkbox" data-bind="checked: settings.plugins.ntfy.event_print_failed"> Ошибка печати
                </label>
                <label class="checkbox">
                    <input type="checkbox" data-bind="checked: settings.plugins.ntfy.event_print_cancelled"> Печать отменена
                </label>
            </div>
        </div>
    </fieldset>

    <fieldset>
        <legend>Тестирование</legend>
        <div class="control-group">
            <div class="controls">
                <button id="send_test_ntfy" class="btn btn-primary">Отправить тестовое уведомление</button>
            </div>
        </div>
    </fieldset>
</form>

<script>
    $(function() {
        $("#send_test_ntfy").on("click", function(e) {
            e.preventDefault(); // Предотвращаем стандартное поведение кнопки
            OctoPrint.simpleApiCommand("ntfy", "send_test_notification", {})
                .done(function() {
                    new PNotify({
                        title: 'Успех',
                        text: 'Команда на отправку тестового уведомления отправлена.',
                        type: 'success'
                    });
                })
                .fail(function() {
                    new PNotify({
                        title: 'Ошибка',
                        text: 'Не удалось отправить команду.',
                        type: 'error'
                    });
                });
        });
    });
</script>
